{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\stanv\\\\dev\\\\react-mesto-api-full\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _slicedToArray from\"C:\\\\Users\\\\stanv\\\\dev\\\\react-mesto-api-full\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import Header from'./Header.js';import Main from'./Main.js';import Footer from'./Footer.js';import{useEffect,useState}from'react';import ImagePopup from'./ImagePopup.js';import{api}from'../utils/api.js';import{CurrentUserContext}from'../contexts/CurrentUserContext.js';import EditProfilePopup from'./EditProfilePopup.js';import EditAvatarPopup from'./EditAvatarPopup.js';import AddPlacePopup from'./AddPlacePopup.js';import ConfirmDeletePopup from'./ConfirmDeletePopup';import{Route,Routes,useNavigate}from'react-router-dom';import*as authApi from'../utils/authApi';import Register from'./Register';import Login from'./Login';import ProtectedRoute from'./ProtectedRoute';import InfoToolTip from'./InfoToolTip';import NotFound from'./NotFound';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setIsEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setIsAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isConfirmDeletePopupOpen=_useState8[0],setIsConfirmDeletePopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isImagePopupOpen=_useState10[0],setIsImagePopupOpen=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),cards=_useState14[0],setCards=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),currentUser=_useState16[0],setCurrentUser=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isLoading=_useState18[0],setIsLoading=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),deletedCard=_useState20[0],setDeletedCard=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isLoggedIn=_useState22[0],setIsLoggedIn=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),email=_useState24[0],setEmail=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isRegisterSuccessful=_useState26[0],setRegisterSuccessful=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),isInfoToolTipOpen=_useState28[0],setIsInfoToolTipOpen=_useState28[1];var navigate=useNavigate();function tokenCheck(){var jwt=localStorage.getItem('jwt');if(!jwt){return;}authApi.verifyUser(jwt).then(function(data){setEmail(data.email);setIsLoggedIn(true);}).catch(function(err){console.log(err);});}useEffect(function(){tokenCheck();},[]);useEffect(function(){var jwt=localStorage.getItem('jwt');if(isLoggedIn){Promise.all([api.getUserInfo(jwt),api.getInitialCards(jwt)]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),user=_ref2[0],cards=_ref2[1];setCurrentUser(user);setCards(cards);}).catch(function(err){console.log(err);});}},[isLoggedIn]);useEffect(function(){isLoggedIn?navigate('/'):navigate('/sign-in');},[isLoggedIn]);function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function closeAllPopups(){setIsAddPlacePopupOpen(false);setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsConfirmDeletePopupOpen(false);setIsInfoToolTipOpen(false);setIsImagePopupOpen(false);setSelectedCard(null);setDeletedCard(null);}function handleCardClick(card){setIsImagePopupOpen(true);setSelectedCard(card);}function handleUpdateUser(name,description){setIsLoading(true);var jwt=localStorage.getItem('jwt');api.editProfile({name:name,description:description},jwt).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setIsLoading(false);});}function handleUpdateAvatar(avatar){var jwt=localStorage.getItem('jwt');setIsLoading(true);api.updateUserAvatar(avatar,jwt).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setIsLoading(false);});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i===currentUser._id;});var jwt=localStorage.getItem('jwt');if(!isLiked){api.likeCard(card._id,jwt).then(function(newCard){setCards(function(cards){return cards.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else{api.dislikeCard(card._id,jwt).then(function(newCard){setCards(function(cards){return cards.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleCardDeleteSubmit(card){var jwt=localStorage.getItem('jwt');setIsLoading(true);api.deleteCard(card._id,jwt).then(function(){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setIsLoading(false);});}function handleAddPlaceSubmit(name,link){var jwt=localStorage.getItem('jwt');setIsLoading(true);api.addNewCard({name:name,link:link},jwt).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setIsLoading(false);});}function handleConfirmCardDelete(card){setIsConfirmDeletePopupOpen(true);setDeletedCard(card);}function onLogin(password,email){setIsLoading(true);authApi.signIn(password,email).then(function(data){var jwt=data.token;localStorage.setItem('jwt',jwt);setIsLoggedIn(true);setEmail(email);}).catch(function(err){console.log(err);}).finally(function(){setIsLoading(false);});}function onRegister(password,email){setIsLoading(true);authApi.signUp(password,email).then(function(data){setEmail(data.email);setIsInfoToolTipOpen(true);setRegisterSuccessful(true);}).catch(function(err){console.log(err);setIsInfoToolTipOpen(true);setRegisterSuccessful(false);}).finally(function(){setIsLoading(false);});}function onLogOut(){localStorage.removeItem('jwt');setIsLoggedIn(false);}function closeInfoToolTip(){closeAllPopups();isRegisterSuccessful?navigate('/'):navigate('/sign-up');}return/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{isLoggedIn:isLoggedIn,email:email||'',onLogOut:onLogOut}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:'/',element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,children:/*#__PURE__*/_jsx(Main,{onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleConfirmCardDelete})})}),/*#__PURE__*/_jsx(Route,{path:'/sign-up',element:/*#__PURE__*/_jsx(Register,{isLoading:isLoading,onRegister:onRegister}),isLoggedIn:isLoggedIn}),/*#__PURE__*/_jsx(Route,{path:'/sign-in',element:/*#__PURE__*/_jsx(Login,{onLogin:onLogin,isLoggedIn:isLoggedIn,isLoading:isLoading})}),/*#__PURE__*/_jsx(Route,{path:'*',element:/*#__PURE__*/_jsx(NotFound,{isLoggedIn:isLoggedIn})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,onLoading:isLoading}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,onLoading:isLoading}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,onLoading:isLoading}),/*#__PURE__*/_jsx(ConfirmDeletePopup,{isOpen:isConfirmDeletePopupOpen,onClose:closeAllPopups,onLoading:isLoading,card:deletedCard,onSubmit:handleCardDeleteSubmit}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,isOpen:isImagePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoToolTip,{isSuccess:isRegisterSuccessful,isOpen:isInfoToolTipOpen,onClose:closeInfoToolTip})]});}export default App;","map":{"version":3,"sources":["C:/Users/stanv/dev/react-mesto-api-full/frontend/src/components/App.js"],"names":["Header","Main","Footer","useEffect","useState","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ConfirmDeletePopup","Route","Routes","useNavigate","authApi","Register","Login","ProtectedRoute","InfoToolTip","NotFound","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isConfirmDeletePopupOpen","setIsConfirmDeletePopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","cards","setCards","currentUser","setCurrentUser","isLoading","setIsLoading","deletedCard","setDeletedCard","isLoggedIn","setIsLoggedIn","email","setEmail","isRegisterSuccessful","setRegisterSuccessful","isInfoToolTipOpen","setIsInfoToolTipOpen","navigate","tokenCheck","jwt","localStorage","getItem","verifyUser","then","data","catch","err","console","log","Promise","all","getUserInfo","getInitialCards","user","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","closeAllPopups","handleCardClick","card","handleUpdateUser","name","description","editProfile","res","finally","handleUpdateAvatar","avatar","updateUserAvatar","handleCardLike","isLiked","likes","some","i","_id","likeCard","newCard","map","c","dislikeCard","handleCardDeleteSubmit","deleteCard","filter","handleAddPlaceSubmit","link","addNewCard","handleConfirmCardDelete","onLogin","password","signIn","token","setItem","onRegister","signUp","onLogOut","removeItem","closeInfoToolTip"],"mappings":"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","sourcesContent":["import Header from './Header.js';\nimport Main from './Main.js';\nimport Footer from './Footer.js';\nimport {useEffect, useState} from 'react';\nimport ImagePopup from './ImagePopup.js';\nimport {api} from '../utils/api.js';\nimport {CurrentUserContext} from '../contexts/CurrentUserContext.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ConfirmDeletePopup from './ConfirmDeletePopup';\nimport {Route, Routes, useNavigate} from 'react-router-dom';\nimport * as authApi from '../utils/authApi'\nimport Register from './Register';\nimport Login from './Login';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoToolTip from './InfoToolTip';\nimport NotFound from './NotFound';\n\nfunction App() {\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen ] = useState(false)\n  const [isConfirmDeletePopupOpen, setIsConfirmDeletePopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [cards, setCards] = useState([]);\n  const [currentUser, setCurrentUser] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [deletedCard, setDeletedCard] = useState(null);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isRegisterSuccessful, setRegisterSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n  const navigate = useNavigate();\n\n  function tokenCheck() {\n    const jwt = localStorage.getItem('jwt');\n    if (!jwt) {\n      return\n    }\n    authApi.verifyUser(jwt)\n      .then((data) => {\n        setEmail(data.email);\n        setIsLoggedIn(true)\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if (isLoggedIn) {\n      Promise.all([api.getUserInfo(jwt), api.getInitialCards(jwt)])\n        .then(([user, cards]) => {\n          setCurrentUser(user);\n          setCards(cards);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }, [isLoggedIn])\n\n  useEffect(() => {\n    isLoggedIn ? navigate('/') : navigate('/sign-in');\n  }, [isLoggedIn])\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsAddPlacePopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsConfirmDeletePopupOpen(false);\n    setIsInfoToolTipOpen(false);\n    setIsImagePopupOpen(false);\n    setSelectedCard(null);\n    setDeletedCard(null);\n  }\n\n  function handleCardClick(card) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  }\n\n  function handleUpdateUser(name, description) {\n    setIsLoading(true);\n    const jwt = localStorage.getItem('jwt');\n    api.editProfile({name, description}, jwt)\n      .then(res => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err)\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleUpdateAvatar(avatar) {\n    const jwt = localStorage.getItem('jwt');\n    setIsLoading(true);\n    api.updateUserAvatar(avatar, jwt)\n      .then(res => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i === currentUser._id);\n    const jwt = localStorage.getItem('jwt');\n    if (!isLiked) {\n      api.likeCard(card._id, jwt)\n        .then((newCard) => {\n          setCards((cards) => cards.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch(err => {\n          console.log(err)\n        });\n    } else {\n      api.dislikeCard(card._id, jwt)\n        .then((newCard) => {\n          setCards((cards) => cards.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch(err => {\n          console.log(err);\n        })\n    }\n  }\n\n  function handleCardDeleteSubmit(card) {\n    const jwt = localStorage.getItem('jwt');\n    setIsLoading(true);\n    api.deleteCard(card._id, jwt)\n      .then(() => {\n        setCards((cards) => {\n          return cards.filter(c => {\n            return c._id !== card._id\n          });\n        });\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleAddPlaceSubmit(name, link) {\n    const jwt = localStorage.getItem('jwt');\n    setIsLoading(true);\n    api.addNewCard({name, link}, jwt)\n      .then(newCard => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleConfirmCardDelete(card) {\n    setIsConfirmDeletePopupOpen(true);\n    setDeletedCard(card);\n  }\n\n  function onLogin(password, email) {\n    setIsLoading(true);\n    authApi.signIn(password, email)\n      .then((data) => {\n        const jwt = data.token;\n        localStorage.setItem('jwt', jwt);\n        setIsLoggedIn(true);\n        setEmail(email);\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function onRegister(password, email) {\n    setIsLoading(true);\n    authApi.signUp(password, email)\n      .then((data) => {\n        setEmail(data.email);\n        setIsInfoToolTipOpen(true);\n        setRegisterSuccessful(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setIsInfoToolTipOpen(true);\n        setRegisterSuccessful(false);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function onLogOut() {\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n  }\n\n  function closeInfoToolTip() {\n    closeAllPopups();\n    isRegisterSuccessful ? navigate('/') : navigate('/sign-up');\n  }\n\n  return (<CurrentUserContext.Provider value={currentUser}>\n    <Header isLoggedIn={isLoggedIn}\n            email={email || ''}\n            onLogOut={onLogOut}/>\n    <Routes>\n      <Route path={'/'}\n             element={<ProtectedRoute isLoggedIn={isLoggedIn}>\n               <Main onEditProfile={handleEditProfileClick}\n                     onAddPlace={handleAddPlaceClick}\n                     onEditAvatar={handleEditAvatarClick}\n                     onCardClick={handleCardClick}\n                     cards={cards}\n                     onCardLike={handleCardLike}\n                     onCardDelete={handleConfirmCardDelete}/>\n             </ProtectedRoute>}/>\n      <Route path={'/sign-up'}\n             element={<Register isLoading={isLoading}\n                                onRegister={onRegister}/>}\n             isLoggedIn={isLoggedIn}/>\n      <Route path={'/sign-in'}\n             element={<Login onLogin={onLogin}\n                             isLoggedIn={isLoggedIn}\n                             isLoading={isLoading}/>}/>\n      <Route path={'*'}\n             element={<NotFound isLoggedIn={isLoggedIn}/>}/>\n    </Routes>\n    <Footer/>\n    <EditProfilePopup isOpen={isEditProfilePopupOpen}\n                      onClose={closeAllPopups}\n                      onUpdateUser={handleUpdateUser}\n                      onLoading={isLoading}/>\n    <EditAvatarPopup isOpen={isEditAvatarPopupOpen}\n                     onClose={closeAllPopups}\n                     onUpdateAvatar={handleUpdateAvatar}\n                     onLoading={isLoading}/>\n    <AddPlacePopup isOpen={isAddPlacePopupOpen}\n                   onClose={closeAllPopups}\n                   onAddPlace={handleAddPlaceSubmit}\n                   onLoading={isLoading}/>\n    <ConfirmDeletePopup isOpen={isConfirmDeletePopupOpen}\n                        onClose={closeAllPopups}\n                        onLoading={isLoading}\n                        card={deletedCard}\n                        onSubmit={handleCardDeleteSubmit}/>\n    <ImagePopup card={selectedCard}\n                isOpen={isImagePopupOpen}\n                onClose={closeAllPopups}/>\n    <InfoToolTip isSuccess={isRegisterSuccessful}\n                 isOpen={isInfoToolTipOpen}\n                 onClose={closeInfoToolTip}/>\n  </CurrentUserContext.Provider>)\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}