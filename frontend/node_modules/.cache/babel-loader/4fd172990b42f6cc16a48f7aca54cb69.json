{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Leonid\\\\dev\\\\react-mesto-auth\\\\src\\\\components\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport { Route, Routes, useNavigate } from 'react-router-dom';\nimport { api } from '../utils/api.js';\nimport * as authApi from '../utils/authApi';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoToolTip from './InfoToolTip';\nimport NotFound from './NotFound';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Footer from './Footer.js';\nimport ImagePopup from './ImagePopup.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ConfirmPopup from './ConfirmPopup';\nimport Register from './Register';\nimport Login from './Login';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isConfirmPopupOpen, setIsConfirmPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [cards, setCards] = useState([]);\n  const [currentUser, setCurrentUser] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [deletedCard, setDeletedCard] = useState(null);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isRegisterSuccessful, setRegisterSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n  const navigate = useNavigate();\n\n  function tokenCheck() {\n    const jwt = localStorage.getItem('jwt');\n\n    if (!jwt) {\n      return;\n    }\n\n    authApi.verifyUser(jwt).then(data => {\n      setEmail(data.data.email);\n      setIsLoggedIn(true);\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n  useEffect(() => {\n    if (isLoggedIn) {\n      Promise.all([api.getUserInfo(), api.getInitialCards()]).then(_ref => {\n        let [user, cards] = _ref;\n        setCurrentUser(user);\n        setCards(cards);\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }, [isLoggedIn]);\n  useEffect(() => {\n    isLoggedIn ? navigate('/react-mesto-auth') : navigate('/sign-in');\n  }, [isLoggedIn]);\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsAddPlacePopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsConfirmPopupOpen(false);\n    setIsInfoToolTipOpen(false);\n    setIsImagePopupOpen(false);\n    setSelectedCard(null);\n    setDeletedCard(null);\n  }\n\n  function handleCardClick(card) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  }\n\n  function handleUpdateUser(name, description) {\n    setIsLoading(true);\n    api.editProfile({\n      name,\n      description\n    }).then(res => {\n      setCurrentUser(res);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function handleUpdateAvatar(avatar) {\n    setIsLoading(true);\n    api.updateUserAvatar(avatar).then(res => {\n      setCurrentUser(res);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n\n    if (!isLiked) {\n      api.addLike(card._id).then(newCard => {\n        setCards(cards => cards.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    } else {\n      api.removeLike(card._id).then(newCard => {\n        setCards(cards => cards.map(c => c._id === card._id ? newCard : c));\n      }).catch(err => {\n        console.log(err);\n      });\n    }\n  }\n\n  function handleCardDeleteSubmit(card) {\n    setIsLoading(true);\n    api.deleteCard(card._id).then(() => {\n      setCards(cards => {\n        return cards.filter(c => {\n          return c._id !== card._id;\n        });\n      });\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function handleAddPlaceSubmit(name, link) {\n    setIsLoading(true);\n    api.addCard({\n      name,\n      link\n    }).then(newCard => {\n      setCards([newCard, ...cards]);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function handleConfirmCardDelete(card) {\n    setIsConfirmPopupOpen(true);\n    setDeletedCard(card);\n  }\n\n  function onLogin(password, email) {\n    setIsLoading(true);\n    authApi.signIn(password, email).then(data => {\n      const jwt = data.token;\n      localStorage.setItem('jwt', jwt);\n      setIsLoggedIn(true);\n      setEmail(email);\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function onRegister(password, email) {\n    setIsLoading(true);\n    authApi.signUp(password, email).then(data => {\n      setEmail(data.data.email);\n      setIsInfoToolTipOpen(true);\n      setRegisterSuccessful(true);\n      setIsLoggedIn(true);\n    }).catch(err => {\n      console.log(err);\n      setIsInfoToolTipOpen(true);\n      setRegisterSuccessful(false);\n    }).finally(() => {\n      setIsLoading(false);\n    });\n  }\n\n  function onLogOut() {\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n  }\n\n  function closeInfoToolTip() {\n    closeAllPopups();\n    isRegisterSuccessful ? navigate('/react-mesto-auth') : navigate('/sign-up');\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: [/*#__PURE__*/_jsxDEV(Header, {\n        isLoggedIn: isLoggedIn,\n        email: email || '',\n        onLogOut: onLogOut\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Routes, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: '/react-mesto-auth',\n          element: /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n            isLoggedIn: isLoggedIn,\n            children: /*#__PURE__*/_jsxDEV(Main, {\n              onEditProfile: handleEditProfileClick,\n              onAddPlace: handleAddPlaceClick,\n              onEditAvatar: handleEditAvatarClick,\n              onCardClick: handleCardClick,\n              cards: cards,\n              onCardLike: handleCardLike,\n              onCardDelete: handleConfirmCardDelete\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 20\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: '/sign-up',\n          element: /*#__PURE__*/_jsxDEV(Register, {\n            isLoading: isLoading,\n            onRegister: onRegister\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 20\n          }, this),\n          isLoggedIn: isLoggedIn\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: '/sign-in',\n          element: /*#__PURE__*/_jsxDEV(Login, {\n            onLogin: onLogin,\n            isLoggedIn: isLoggedIn,\n            isLoading: isLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 20\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: '*',\n          element: /*#__PURE__*/_jsxDEV(NotFound, {\n            isLoggedIn: isLoggedIn\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 20\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n        isOpen: isEditProfilePopupOpen,\n        onClose: closeAllPopups,\n        onUpdateUser: handleUpdateUser,\n        onLoading: isLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n        isOpen: isEditAvatarPopupOpen,\n        onClose: closeAllPopups,\n        onUpdateAvatar: handleUpdateAvatar,\n        onLoading: isLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n        isOpen: isAddPlacePopupOpen,\n        onClose: closeAllPopups,\n        onAddPlace: handleAddPlaceSubmit,\n        onLoading: isLoading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(ConfirmPopup, {\n        isOpen: isConfirmPopupOpen,\n        onClose: closeAllPopups,\n        onLoading: isLoading,\n        card: deletedCard,\n        onSubmit: handleCardDeleteSubmit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n        card: selectedCard,\n        isOpen: isImagePopupOpen,\n        onClose: closeAllPopups\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(InfoToolTip, {\n        isSuccess: isRegisterSuccessful,\n        isOpen: isInfoToolTipOpen,\n        onClose: closeInfoToolTip\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 239,\n    columnNumber: 11\n  }, this);\n}\n\n_s(App, \"kE+XkJnSuZp8KyP/AHu7tb6CuPA=\", false, function () {\n  return [useNavigate];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/Leonid/dev/react-mesto-auth/src/components/App.js"],"names":["useEffect","useState","CurrentUserContext","Route","Routes","useNavigate","api","authApi","ProtectedRoute","InfoToolTip","NotFound","Header","Main","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ConfirmPopup","Register","Login","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isConfirmPopupOpen","setIsConfirmPopupOpen","isImagePopupOpen","setIsImagePopupOpen","selectedCard","setSelectedCard","cards","setCards","currentUser","setCurrentUser","isLoading","setIsLoading","deletedCard","setDeletedCard","isLoggedIn","setIsLoggedIn","email","setEmail","isRegisterSuccessful","setRegisterSuccessful","isInfoToolTipOpen","setIsInfoToolTipOpen","navigate","tokenCheck","jwt","localStorage","getItem","verifyUser","then","data","catch","err","console","log","Promise","all","getUserInfo","getInitialCards","user","handleEditAvatarClick","setEditAvatarPopupOpen","handleEditProfileClick","setEditProfilePopupOpen","handleAddPlaceClick","setAddPlacePopupOpen","closeAllPopups","handleCardClick","card","handleUpdateUser","name","description","editProfile","res","finally","handleUpdateAvatar","avatar","updateUserAvatar","handleCardLike","isLiked","likes","some","i","_id","addLike","newCard","map","c","removeLike","handleCardDeleteSubmit","deleteCard","filter","handleAddPlaceSubmit","link","addCard","handleConfirmCardDelete","onLogin","password","signIn","token","setItem","onRegister","signUp","onLogOut","removeItem","closeInfoToolTip"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js';\nimport {Route, Routes, useNavigate} from 'react-router-dom';\nimport {api} from '../utils/api.js';\nimport * as authApi from '../utils/authApi'\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoToolTip from './InfoToolTip';\nimport NotFound from './NotFound';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport Footer from './Footer.js';\nimport ImagePopup from './ImagePopup.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport ConfirmPopup from './ConfirmPopup';\nimport Register from './Register';\nimport Login from './Login';\n\nfunction App() {\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false)\n  const [isConfirmPopupOpen, setIsConfirmPopupOpen] = useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [cards, setCards] = useState([]);\n  const [currentUser, setCurrentUser] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [deletedCard, setDeletedCard] = useState(null);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isRegisterSuccessful, setRegisterSuccessful] = useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = useState(false);\n  const navigate = useNavigate();\n\n  function tokenCheck() {\n    const jwt = localStorage.getItem('jwt');\n    if (!jwt) {\n      return\n    }\n    authApi.verifyUser(jwt)\n      .then((data) => {\n        setEmail(data.data.email);\n        setIsLoggedIn(true)\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n  }\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  useEffect(() => {\n    if (isLoggedIn) {\n      Promise.all([api.getUserInfo(), api.getInitialCards()])\n        .then(([user, cards]) => {\n          setCurrentUser(user);\n          setCards(cards);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }, [isLoggedIn])\n\n  useEffect(() => {\n    isLoggedIn ? navigate('/react-mesto-auth') : navigate('/sign-in');\n  }, [isLoggedIn])\n\n\n  function handleEditAvatarClick() {\n    setEditAvatarPopupOpen(true);\n  }\n\n  function handleEditProfileClick() {\n    setEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setAddPlacePopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsAddPlacePopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsConfirmPopupOpen(false);\n    setIsInfoToolTipOpen(false);\n    setIsImagePopupOpen(false);\n    setSelectedCard(null);\n    setDeletedCard(null);\n  }\n\n  function handleCardClick(card) {\n    setIsImagePopupOpen(true);\n    setSelectedCard(card);\n  }\n\n  function handleUpdateUser(name, description) {\n    setIsLoading(true);\n    api.editProfile({name, description})\n      .then(res => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err)\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleUpdateAvatar(avatar) {\n    setIsLoading(true);\n    api.updateUserAvatar(avatar)\n      .then(res => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    if (!isLiked) {\n      api.addLike(card._id)\n        .then((newCard) => {\n          setCards((cards) => cards.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch(err => {\n          console.log(err)\n        });\n    } else {\n      api.removeLike(card._id)\n        .then((newCard) => {\n          setCards((cards) => cards.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch(err => {\n          console.log(err);\n        })\n    }\n  }\n\n  function handleCardDeleteSubmit(card) {\n    setIsLoading(true);\n    api.deleteCard(card._id)\n      .then(() => {\n        setCards((cards) => {\n          return cards.filter(c => {\n            return c._id !== card._id\n          });\n        });\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleAddPlaceSubmit(name, link) {\n    setIsLoading(true);\n    api.addCard({ name, link })\n      .then(newCard => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function handleConfirmCardDelete(card) {\n    setIsConfirmPopupOpen(true);\n    setDeletedCard(card);\n  }\n\n  function onLogin(password, email) {\n    setIsLoading(true);\n    authApi.signIn(password, email)\n      .then((data) => {\n        const jwt = data.token;\n        localStorage.setItem('jwt', jwt);\n        setIsLoggedIn(true);\n        setEmail(email);\n      })\n      .catch(err => {\n        console.log(err);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function onRegister(password, email) {\n    setIsLoading(true);\n    authApi.signUp(password, email)\n      .then((data) => {\n        setEmail(data.data.email);\n        setIsInfoToolTipOpen(true);\n        setRegisterSuccessful(true);\n        setIsLoggedIn(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setIsInfoToolTipOpen(true);\n        setRegisterSuccessful(false);\n      })\n      .finally(() => {\n        setIsLoading(false);\n      })\n  }\n\n  function onLogOut() {\n    localStorage.removeItem('jwt');\n    setIsLoggedIn(false);\n  }\n\n  function closeInfoToolTip() {\n    closeAllPopups();\n    isRegisterSuccessful ? navigate('/react-mesto-auth') : navigate('/sign-up');\n  }\n\n  return (<div className=\"page\">\n    <CurrentUserContext.Provider value={currentUser}>\n      <Header isLoggedIn={isLoggedIn}\n            email={email || ''}\n            onLogOut={onLogOut}/>\n      <Routes>\n        <Route path={'/react-mesto-auth'}\n          element={<ProtectedRoute isLoggedIn={isLoggedIn}>\n            <Main onEditProfile={handleEditProfileClick}\n              onAddPlace={handleAddPlaceClick}\n              onEditAvatar={handleEditAvatarClick}\n              onCardClick={handleCardClick}\n              cards={cards}\n              onCardLike={handleCardLike}\n              onCardDelete={handleConfirmCardDelete} />\n          </ProtectedRoute>} />\n        <Route path={'/sign-up'}\n          element={<Register isLoading={isLoading}\n            onRegister={onRegister} />}\n          isLoggedIn={isLoggedIn} />\n        <Route path={'/sign-in'}\n          element={<Login onLogin={onLogin}\n            isLoggedIn={isLoggedIn}\n            isLoading={isLoading} />} />\n        <Route path={'*'}\n          element={<NotFound isLoggedIn={isLoggedIn} />} />\n      </Routes>\n      <Footer />\n      <EditProfilePopup isOpen={isEditProfilePopupOpen}\n        onClose={closeAllPopups}\n        onUpdateUser={handleUpdateUser}\n        onLoading={isLoading} />\n      <EditAvatarPopup isOpen={isEditAvatarPopupOpen}\n        onClose={closeAllPopups}\n        onUpdateAvatar={handleUpdateAvatar}\n        onLoading={isLoading} />\n      <AddPlacePopup isOpen={isAddPlacePopupOpen}\n        onClose={closeAllPopups}\n        onAddPlace={handleAddPlaceSubmit}\n        onLoading={isLoading} />\n      <ConfirmPopup isOpen={isConfirmPopupOpen}\n        onClose={closeAllPopups}\n        onLoading={isLoading}\n        card={deletedCard}\n        onSubmit={handleCardDeleteSubmit} />\n      <ImagePopup card={selectedCard}\n      isOpen={isImagePopupOpen}\n        onClose={closeAllPopups} />\n      <InfoToolTip isSuccess={isRegisterSuccessful}\n                 isOpen={isInfoToolTipOpen}\n                 onClose={closeInfoToolTip}/>\n    </CurrentUserContext.Provider>\n  </div>)\n}\n\nexport default App;\n\n"]},"metadata":{},"sourceType":"module"}